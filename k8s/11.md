# Kubernetes Secrets and Hashicorp Vault

## Task 1

I created a Kubernetes Secret named `val-secret`:

```
% kubectl create secret generic val-secret --from-literal=username=myuser --from-literal=password=‘nTapHaRecToN’
```

I confirmed the existence of the secret and decoded its contents using the following commands:

```
% kubectl get secret val-secret -o jsonpath='{.data.username}' | base64 --decode

myuser%    
```       

I retrieved the pods and the secret inside the pod:

```
% kubectl get po
NAME                                     READY   STATUS    RESTARTS       AGE
app-python-1713296557-7466cf5f45-t8rvd   1/1     Running   0              30s
```
```
% kubectl exec app-python-1713296557-7466cf5f45-t8rvd -- printenv | grep MY_PASSWORD
MY_PASSWORD=secret123
```

## Task 2

I implemented vault secret management system:

```
% kubectl get pods
NAME                                     READY   STATUS    RESTARTS       AGE
app-python-1713296557-7466cf5f45-t8rvd   1/1     Running   0              22m
vault-0                                  1/1     Running   0              5m18s
vault-agent-injector-dbfc5cd77-twhnp     1/1     Running   0              5m18s
```

```
% kubectl exec -it vault-0 -- /bin/sh                               
/ $ vault secrets enable -path=internal kv-v2
Success! Enabled the kv-v2 secrets engine at: internal/
/ $ vault kv put internal/server/config password="1111"
======= Secret Path =======
internal/data/server/config

======= Metadata =======
Key                Value
---                -----
created_time       2024-04-16T20:06:38.86744668Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
/ $ vault kv get internal/server/config
======= Secret Path =======
internal/data/server/config

======= Metadata =======
Key                Value
---                -----
created_time       2024-04-16T20:06:38.86744668Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1

====== Data ======
Key         Value
---         -----
password    1111
/ $ vault auth enable kubernetes
Success! Enabled kubernetes auth method at: kubernetes/
/ $ vault write auth/kubernetes/config kubernetes_host="https://$KUBERNETES_PORT_443_TCP_ADDR:443"
Success! Data written to: auth/kubernetes/config
/ $ vault policy write internal-app - <<EOF
> path "internal/data/database/config" {
>    capabilities = ["read"]
> }
> EOF
Success! Uploaded policy: internal-app
/ $ exit
```

```
exemplerie@MacBook-Air-Valeria k8s % kubectl exec -it app-python-1713296557-7466cf5f45-t8rvd -- /bin/df -h
Filesystem      Size  Used  Avail Use% Mounted on
overlay          59G  7.8G    48G  14% /
tmpfs            64M     0    64M   0% /dev
/dev/vda1        59G  7.8G    48G  14% /dev/termination-log
/dev/vda1        59G  7.8G    48G  14% /etc/resolv.conf
/dev/vda1        59G  7.8G    48G  14% /etc/hostname
/dev/vda1        59G  7.8G    48G  14% /etc/hosts
shm              64M     0    64M   0% /dev/shm
tmpfs           7.7G   12K   7.7G   1% /run/secrets/kubernetes.io/serviceaccount
tmpfs           64M      0  64.0M   0% /proc/kcore
tmpfs           64M      0  64.0M   0% /proc/keys
tmpfs           64M      0  64.0M   0% /proc/timer_list
tmpfs           3.9G     0   3.9G   0% /sys/firmware
```