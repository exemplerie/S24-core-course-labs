## The Kube Prometheus components:

- Prometheus: Collects and stores time-series data for monitoring. It scrapes metrics from configured targets.

- Grafana: Provides a dashboarding and visualization platform. Grafana can pull data from Prometheus and display it in customizable dashboards.

- Alertmanager: Handles alerts sent by Prometheus. It can route, group, and silence these alerts before sending notifications to external systems.

- kube-state-metrics: Generates Kubernetes-specific metrics like deployments, nodes, pods, etc., which are then scraped by Prometheus.

- Prometheus Node-Exporte: Exposes hardware and OS metrics about nodes. This information is collected by Prometheus to monitor node-level resource usage.

- Prometheus Adapter: Retrieves custom metrics from Kubernetes APIs and exposes them in a Prometheus-friendly format.

- Prometheus Blackbox Exporter: Probes endpoints over HTTP, HTTPS, DNS, TCP, and ICMP, generating metrics based on the probe results.

- Prometheus Operator: Manages Prometheus instances and related monitoring components in a Kubernetes cluster. It simplifies the deployment, management, and scaling of Prometheus and related monitoring components.

## Helm Charts

```
exemplerie@MacBook-Air-Valeria S24-core-course-labs % kubectl get po,sts,svc,pvc,cm 
```

Shows currently running pods:
```
NAME                                                            READY   STATUS    RESTARTS   AGE
pod/alertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   0          74s
pod/devops-lab-statefulset-app-python-0                         1/1     Running   1          5d21h
pod/devops-lab-statefulset-app-python-1                         1/1     Running   1          5d21h
pod/kube-prometheus-stack-grafana-7cf5785ff8-2wqbf              3/3     Running   0          95s
pod/kube-prometheus-stack-kube-state-metrics-65594f9476-zpdgq   1/1     Running   0          95s
pod/kube-prometheus-stack-operator-985449d44-4f8hs              1/1     Running   0          95s
pod/kube-prometheus-stack-prometheus-node-exporter-6ql29        1/1     Running   0          95s
pod/prometheus-kube-prometheus-stack-prometheus-0               2/2     Running   0          74s
```

Displays stateful sets:
```
NAME                                                               READY   AGE
statefulset.apps/alertmanager-kube-prometheus-stack-alertmanager   1/1     74s
statefulset.apps/devops-lab-statefulset-app-python                 2/2     5d21h
statefulset.apps/prometheus-kube-prometheus-stack-prometheus       1/1     74s
```

Lists services:
```
NAME                                                     TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                            ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   75s
service/app-python-service                               LoadBalancer   10.98.82.162     <pending>     6000:32101/TCP               33d
service/devops-lab-statefulset-app-python                ClusterIP      10.98.78.79      <none>        6000/TCP                     5d21h
service/helm-hooks-app-python                            ClusterIP      10.104.112.151   <none>        6000/TCP                     25d
service/kube-prometheus-stack-alertmanager               ClusterIP      10.107.245.41    <none>        9093/TCP,8080/TCP            95s
service/kube-prometheus-stack-grafana                    ClusterIP      10.96.139.37     <none>        80/TCP                       95s
service/kube-prometheus-stack-kube-state-metrics         ClusterIP      10.98.212.102    <none>        8080/TCP                     95s
service/kube-prometheus-stack-operator                   ClusterIP      10.98.127.159    <none>        443/TCP                      95s
service/kube-prometheus-stack-prometheus                 ClusterIP      10.96.115.60     <none>        9090/TCP,8080/TCP            95s
service/kube-prometheus-stack-prometheus-node-exporter   ClusterIP      10.106.237.237   <none>        9100/TCP                     95s
service/kubernetes                                       ClusterIP      10.96.0.1        <none>        443/TCP                      33d
service/prometheus-operated                              ClusterIP      None             <none>        9090/TCP                     74s
```

Shows persistent volume claims:
```
NAME                                                             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/data-devops-lab-statefulset-app-python-0   Bound    pvc-26bce882-4759-4375-b689-3b083dace030   1Gi        RWO            standard       5d21h
persistentvolumeclaim/data-devops-lab-statefulset-app-python-1   Bound    pvc-f0a7f537-e978-4d02-a92e-9e47c92f3874   1Gi        RWO            standard       5d21h
```

Lists config maps:
```
NAME                                                                DATA   AGE
configmap/config                                                    1      5d21h
configmap/kube-prometheus-stack-alertmanager-overview               1      95s
configmap/kube-prometheus-stack-apiserver                           1      95s
configmap/kube-prometheus-stack-cluster-total                       1      95s
configmap/kube-prometheus-stack-controller-manager                  1      95s
configmap/kube-prometheus-stack-etcd                                1      95s
configmap/kube-prometheus-stack-grafana                             1      95s
configmap/kube-prometheus-stack-grafana-config-dashboards           1      95s
configmap/kube-prometheus-stack-grafana-datasource                  1      95s
configmap/kube-prometheus-stack-grafana-overview                    1      95s
configmap/kube-prometheus-stack-k8s-coredns                         1      95s
configmap/kube-prometheus-stack-k8s-resources-cluster               1      95s
configmap/kube-prometheus-stack-k8s-resources-multicluster          1      95s
configmap/kube-prometheus-stack-k8s-resources-namespace             1      95s
configmap/kube-prometheus-stack-k8s-resources-node                  1      95s
configmap/kube-prometheus-stack-k8s-resources-pod                   1      95s
configmap/kube-prometheus-stack-k8s-resources-workload              1      95s
configmap/kube-prometheus-stack-k8s-resources-workloads-namespace   1      95s
configmap/kube-prometheus-stack-kubelet                             1      95s
configmap/kube-prometheus-stack-namespace-by-pod                    1      95s
configmap/kube-prometheus-stack-namespace-by-workload               1      95s
configmap/kube-prometheus-stack-node-cluster-rsrc-use               1      95s
configmap/kube-prometheus-stack-node-rsrc-use                       1      95s
configmap/kube-prometheus-stack-nodes                               1      95s
configmap/kube-prometheus-stack-nodes-darwin                        1      95s
configmap/kube-prometheus-stack-persistentvolumesusage              1      95s
configmap/kube-prometheus-stack-pod-total                           1      95s
configmap/kube-prometheus-stack-prometheus                          1      95s
configmap/kube-prometheus-stack-proxy                               1      95s
configmap/kube-prometheus-stack-scheduler                           1      95s
configmap/kube-prometheus-stack-workload-total                      1      95s
configmap/kube-root-ca.crt                                          1      33d
configmap/prometheus-kube-prometheus-stack-prometheus-rulefiles-0   35     74s
```

## Grafana Dashboards

a. Check CPU and Memory consumption of your StatefulSet.

Answer: 0.004% CPU time and 152 MB

![Alt text](screenshots/CPU.png?raw=true)

b. Identify Pods with higher and lower CPU usage in the default namespace.

Answer: 
Highest CPU usage (0.04) app-python, Lowest CPU usage (0.01) prometheus

![Alt text](screenshots/higher_lower_pods.png?raw=true)

c. Monitor node memory usage in percentage and megabytes.

Answer: 2.42 GiB (33.3%)

![Alt text](screenshots/memory_usage.png?raw=true)

d. Count the number of pods and containers managed by the Kubelet service.

Answer: 18 pods and 26 containers.

![Alt text](screenshots/pods_containers.png?raw=true)

e. Evaluate network usage of Pods in the default namespace.

Answer: 33.3 kB/s download speed and 172 kB/s upload speed.


![Alt text](screenshots/bandwidth.png?raw=true)

f. Determine the number of active alerts; also check the Web UI with `minikube service monitoring-kube-prometheus-alertmanager`.

Answer: 9 alerts

![Alt text](screenshots/alerts_1.png?raw=true)
![Alt text](screenshots/alerts_2.png?raw=true)

## Init container

```
exemplerie@MacBook-Air-Valeria k8s % kubectl exec pod/devops-lab-statefulset-app-python-0 -- cat /demo/demo-site.html
Defaulted container "app-python" out of: app-python, download-file (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```